<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eluun - Official</title>
    <link rel="stylesheet" href="styles.css">
    <script src="script.js" defer></script>
</head>
<body>
    <!-- Main container -->
    <div class="container">
        <!-- Profile Section -->
        <div class="profile">
            <img src="profile.png" alt="Eluun" class="profile-pic">
            <h1 class="artist-name">Eluun</h1>
        </div>

        <!-- Subscription Form -->
        <div class="form-container">
            <h2>Give your strongest support to my independence</h2>
            <form id="phone-form">
                <p class="content-text">Today's music world is terribly hard on independent, non-mainstream and underground artists.<br>
                    <br>
                    Dependence on algorithms is a veritable plague that is slowly killing our industry. This is the observation I make every day as a player in this industry.<br>
                    <br>
                    That's why I want to take strong action and stop putting my trust in platforms like Spotify ou Instagram, which severely limit the support you want to give me by profoundly limiting my visibility.<br>
                    <br>
                    I've been looking for an alternative solution for a long time, and Patreon seems to be the best one. <br>
                    <br>
                    You can join my free channel and centralize my communication on this platform, which has been adopted by the majority of today's independent artists.
                    Patreon is browser-based, and will keep you informed by e-mail, but the best way to offer me support et visibility est de télécharger l'application mobile, qui peut envoyer des notifications directement à votre téléphone pour vous tenir informé de mes progrès. Et vous pouvez vous désabonner à tout moment.<br>
                    <br>
                    Je ne pourrai jamais assez remercier les personnes qui décident de s'inscrire ici.<br>
                    <br>
                    Eluun</p>

                    <button type="button" onclick="handleDiscordAuth()" class="discord-button">
                        Join us on Discord
                    </button>

<script>
  // Fonction pour obtenir les paramètres d'URL
  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }

  // Fonction pour gérer l'authentification Discord
  async function handleDiscordAuth() {
    try {
      const response = await fetch('/.netlify/functions/getConfig');
      if (!response.ok) throw new Error('Config fetch failed');
      
      const config = await response.json();
      const clientId = config.clientId;
      const redirectUri = encodeURIComponent(config.redirectUri);
      const scope = 'identify guilds.join';
      
      const url = `https://discord.com/api/oauth2/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}`;
      window.location.href = url;
    } catch (error) {
      console.error('Discord auth error:', error);
    }
  }

  // Gestion du callback
  window.onload = async () => {
    const userId = getQueryParam('userId');
    if (userId) {
      console.log('User ID:', userId);
      joinDiscord(userId);
    }
  };

  // Fonction pour rejoindre Discord
  function joinDiscord(userId) {
    fetch(`/.netlify/functions/addRole?userId=${userId}`)
      .then(response => response.text())
      .then(data => {
        console.log('Response:', data);
        alert(data);
      })
      .catch(error => console.error('Error:', error));
  }
</script>
</body>
</html>